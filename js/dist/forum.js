(()=>{var t={n:o=>{var r=o&&o.__esModule?()=>o.default:()=>o;return t.d(r,{a:r}),r},d:(o,r)=>{for(var e in r)t.o(r,e)&&!t.o(o,e)&&Object.defineProperty(o,e,{enumerable:!0,get:r[e]})},o:(t,o)=>Object.prototype.hasOwnProperty.call(t,o)};(()=>{"use strict";const o=flarum.core.compat["common/app"];t.n(o)().initializers.add("justoverclock/profile-stories",(function(){console.log("[justoverclock/profile-stories] Hello, forum and admin!")}));const r=flarum.core.compat["forum/app"];var e=t.n(r);const s=flarum.core.compat["common/extend"];function n(t,o){return n=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,o){return t.__proto__=o,t},n(t,o)}function a(t,o){t.prototype=Object.create(o.prototype),t.prototype.constructor=t,n(t,o)}const i=flarum.core.compat["forum/components/UserPage"];var l=t.n(i);const c=flarum.core.compat["common/helpers/listItems"];var u=t.n(c);const p=flarum.core.compat["common/Component"];var f=t.n(p);const h=flarum.core.compat["common/components/Modal"];var d=t.n(h);const y=flarum.core.compat["common/utils/Stream"];var v=t.n(y),g=function(t){function o(){for(var o,r=arguments.length,e=new Array(r),s=0;s<r;s++)e[s]=arguments[s];return(o=t.call.apply(t,[this].concat(e))||this).step=0,o.story_title=v()(""),o.story_imgUrl=v()(""),o.story_cta=v()(""),o.story_icon=v()(""),o.story_text=v()(""),o.story_content_cta=v()(""),o.story_content_link=v()(""),o}a(o,t);var r=o.prototype;return r.className=function(){return"create-story-modal"},r.title=function(){return e().translator.trans("justoverclock-profile-stories.forum.createStory")},r.content=function(){var t=this;return m("div",{className:"new-story-container"},m("div",{className:"new-story-content"},0===this.step&&m("div",{className:"story-step-container"},m("input",{value:this.story_title(),oninput:function(o){return t.story_title(o.target.value)},placeholder:e().translator.trans("justoverclock-profile-stories.forum.storyTitle"),className:"FormControl",type:"text"}),m("input",{value:this.story_imgUrl(),oninput:function(o){return t.story_imgUrl(o.target.value)},placeholder:e().translator.trans("justoverclock-profile-stories.forum.storyImage"),className:"FormControl",type:"url"}),m("input",{value:this.story_cta(),oninput:function(o){return t.story_cta(o.target.value)},placeholder:e().translator.trans("justoverclock-profile-stories.forum.storyCta"),className:"FormControl",type:"text"})),1===this.step&&m("div",{className:"story-step-container"},m("input",{value:this.story_icon(),oninput:function(o){return t.story_icon(o.target.value)},placeholder:e().translator.trans("justoverclock-profile-stories.forum.storyIcon"),className:"FormControl",type:"text"}),m("input",{value:this.story_content_link(),oninput:function(o){return t.story_content_link(o.target.value)},placeholder:e().translator.trans("justoverclock-profile-stories.forum.storyContentLink"),className:"FormControl",type:"text"}),m("input",{value:this.story_content_cta(),oninput:function(o){return t.story_content_cta(o.target.value)},placeholder:e().translator.trans("justoverclock-profile-stories.forum.storyContentCta"),className:"FormControl",type:"text"}),m("textarea",{rows:6,value:this.story_text(),oninput:function(o){return t.story_text(o.target.value)},placeholder:e().translator.trans("justoverclock-profile-stories.forum.storyContentText"),className:"FormControl"}))),m("form",{className:"new-story-actions",onsubmit:function(t){return t.preventDefault()}},m("button",{disabled:this.step<1,className:"Button",onclick:this.stepDecrement.bind(this)},e().translator.trans("justoverclock-profile-stories.forum.previousStepBtn")),this.step<1&&m("button",{className:"Button",onclick:this.stepIncrement.bind(this)},e().translator.trans("justoverclock-profile-stories.forum.nextStepBtn")),1===this.step&&m("button",{onclick:this.complete.bind(this),className:"Button",type:"submit"},e().translator.trans("justoverclock-profile-stories.forum.saveBtn"))))},r.stepIncrement=function(){this.step<1&&(this.step++,m.redraw()),m.redraw()},r.stepDecrement=function(){this.step>0&&(this.step--,m.redraw()),m.redraw()},r.complete=function(){var t=this;e().request({method:"POST",url:e().forum.attribute("apiUrl")+"/create-story",body:{data:{attributes:{user_id:this.attrs.userId,title:this.story_title(),img_url:this.story_imgUrl(),cta:this.story_cta(),content_icon:this.story_icon(),content_text:this.story_text(),content_cta:this.story_content_cta(),content_link:this.story_content_link(),username:this.attrs.username}}}}).then((function(){t.hide(),t.attrs.refreshStories()}))},o}(d()),b=function(t){function o(){return t.apply(this,arguments)||this}a(o,t);var r=o.prototype;return r.oninit=function(o){t.prototype.oninit.call(this,o)},r.view=function(t){return m("div",{className:"permission-denied-container"},m("div",{className:"permission-denied-content"},e().translator.trans("justoverclock-profile-stories.forum.youDontHavePermission")))},o}(f());const _=flarum.core.compat["common/components/Link"];var k=t.n(_),N=function(t){function o(){return t.apply(this,arguments)||this}a(o,t);var r=o.prototype;return r.className=function(){return"complete-story-modal"},r.title=function(){var t;return this.attrs.story,(null==(t=e().session)||null==(t=t.user)?void 0:t.displayName())+" "+e().translator.trans("justoverclock-profile-stories.forum.StoryModalTitle")},r.content=function(){var t=this.attrs.story;return m("div",{className:"complete-story-container"},m("div",{className:"complete-story-content"},m("div",{className:"complete-story-title"},m("i",{class:"story-icon fa-solid "+t.attributes.contentIcon}),m("h3",null,t.attributes.title)),m("img",{className:"complete-story-img",src:t.attributes.imgUrl,alt:t.attributes.title}),m("p",null,m.trust(t.attributes.contentText)),m("div",{className:"complete-story-btn"},m(k(),{href:t.attributes.contentLink},m("button",{className:"Button final-button"},t.attributes.contentCta)))))},o}(d());const S=flarum.core.compat["common/components/LoadingIndicator"];var j=t.n(S),x=function(t){function o(){for(var o,r=arguments.length,e=new Array(r),s=0;s<r;s++)e[s]=arguments[s];return(o=t.call.apply(t,[this].concat(e))||this).story_title=v()(""),o.story_imgUrl=v()(""),o.story_cta=v()(""),o.story_icon=v()(""),o.story_text=v()(""),o.story_content_cta=v()(""),o.story_content_link=v()(""),o}a(o,t);var r=o.prototype;return r.oncreate=function(o){t.prototype.oncreate.call(this,o),this.story_title(this.attrs.story.attributes.title),this.story_imgUrl(this.attrs.story.attributes.imgUrl),this.story_cta(this.attrs.story.attributes.cta),this.story_icon(this.attrs.story.attributes.contentIcon),this.story_text(this.attrs.story.attributes.contentText),this.story_content_cta(this.attrs.story.attributes.contentCta),this.story_content_link(this.attrs.story.attributes.contentLink)},r.className=function(){return"edit-story-modal"},r.title=function(){return""+e().translator.trans("justoverclock-profile-stories.forum.editStoryModal")},r.content=function(){var t=this;return m("div",{className:"new-story-container"},m("div",{className:"new-story-content"},m("div",{className:"story-step-container"},m("label",{htmlFor:"title"},e().translator.trans("justoverclock-profile-stories.forum.storyTitleInput")),m("input",{value:this.story_title(),oninput:function(o){return t.story_title(o.target.value)},placeholder:this.attrs.story.attributes.title,className:"FormControl",type:"text"}),m("label",{htmlFor:"story_imgUrl"},e().translator.trans("justoverclock-profile-stories.forum.storyImgInput")),m("input",{value:this.story_imgUrl(),oninput:function(o){return t.story_imgUrl(o.target.value)},placeholder:e().translator.trans("justoverclock-profile-stories.forum.storyImage"),className:"FormControl",type:"url"}),m("label",{htmlFor:"story_cta"},e().translator.trans("justoverclock-profile-stories.forum.storyBtnTextInput")),m("input",{value:this.story_cta(),oninput:function(o){return t.story_cta(o.target.value)},placeholder:e().translator.trans("justoverclock-profile-stories.forum.storyCta"),className:"FormControl",type:"text"}),m("label",{htmlFor:"story_icon"},e().translator.trans("justoverclock-profile-stories.forum.storyIconInput")),m("input",{value:this.story_icon(),oninput:function(o){return t.story_icon(o.target.value)},placeholder:e().translator.trans("justoverclock-profile-stories.forum.storyIcon"),className:"FormControl",type:"text"}),m("label",{htmlFor:"story_content_link"},e().translator.trans("justoverclock-profile-stories.forum.storyLinkInput")),m("input",{value:this.story_content_link(),oninput:function(o){return t.story_content_link(o.target.value)},placeholder:e().translator.trans("justoverclock-profile-stories.forum.storyContentLink"),className:"FormControl",type:"text"}),m("label",{htmlFor:"story_content_cta"},e().translator.trans("justoverclock-profile-stories.forum.storyLinkButtonInput")),m("input",{value:this.story_content_cta(),oninput:function(o){return t.story_content_cta(o.target.value)},placeholder:e().translator.trans("justoverclock-profile-stories.forum.storyContentCta"),className:"FormControl",type:"text"}),m("label",{htmlFor:"story_text"},e().translator.trans("justoverclock-profile-stories.forum.storyTextInput")),m("textarea",{rows:6,value:this.story_text(),oninput:function(o){return t.story_text(o.target.value)},placeholder:e().translator.trans("justoverclock-profile-stories.forum.storyContentText"),className:"FormControl"}))),m("form",{className:"new-story-actions"},m("button",{className:"Button",onclick:this.editStory.bind(this)},e().translator.trans("justoverclock-profile-stories.forum.editStoryModalBtn"))))},r.editStory=function(){var t=this;e().request({method:"PATCH",url:e().forum.attribute("apiUrl")+"/stories/"+this.attrs.story.id,body:{data:{attributes:{user_id:this.attrs.story.attributes.userId,title:this.story_title(),img_url:this.story_imgUrl(),cta:this.story_cta(),content_icon:this.story_icon(),content_text:this.story_text(),content_cta:this.story_content_cta(),content_link:this.story_content_link(),username:this.attrs.user.username()}}}}).then((function(){t.hide(),e().alerts.show({type:"success"},e().translator.trans("justoverclock-profile-stories.forum.successEdited"))}))},o}(d()),w=function(t){function o(){for(var o,r=arguments.length,e=new Array(r),s=0;s<r;s++)e[s]=arguments[s];return(o=t.call.apply(t,[this].concat(e))||this).userStories=null,o.currentPage=1,o.totalPages=1,o.loading=!1,o}a(o,t);var r=o.prototype;return r.oninit=function(o){t.prototype.oninit.call(this,o),this.loading=!1,this.currentPage=1,this.totalPages=1,this.getAllUserStory()},r.showCreateStoryModal=function(){var t;e().modal.show(g,{refreshStories:this.getAllUserStory.bind(this),username:null==(t=this.attrs.user.data)||null==(t=t.attributes)?void 0:t.username,userId:this.attrs.user.id()})},r.getAllUserStory=function(t){var o=this;void 0===t&&(t=e().forum.attribute("apiUrl")+"/stories?userId="+this.attrs.userId),this.loading=!0,e().request({method:"GET",url:t}).then((function(t){o.userStories=t,m.redraw()})).finally((function(){o.loading=!1,m.redraw()}))},r.deleteStory=function(t){var o=this;e().request({method:"DELETE",url:e().forum.attribute("apiUrl")+"/delete-story/"+t}).then((function(){o.getAllUserStory(),e().alerts.show({type:"success"},e().translator.trans("justoverclock-profile-stories.forum.successDelete"))}))},r.view=function(t){var o,r,s,n,a,i=this,l=this.attrs.user,c=(null==l||null==(o=l.data.attributes)?void 0:o.canCreateStory)||!1,u=(null==l||null==(r=l.data.attributes)?void 0:r.canDeleteStory)||!1,p=(null==l||null==(s=l.data.attributes)?void 0:s.canEditStory)||!1;return m("div",{className:"PostsUserPage"},this.loading&&m(j(),null),!this.loading&&m("div",{className:"stories-content"},!c&&m(b,null),c&&m("button",{onclick:this.showCreateStoryModal.bind(this),className:"Button Button--primary stories-btn"},e().translator.trans("justoverclock-profile-stories.forum.createStory")),m("div",{className:"stories-all"},this.userStories&&this.userStories.data.map((function(t){return m("div",{className:"story-item",style:{backgroundImage:"url("+t.attributes.imgUrl+")",backgroundSize:"cover"}},m("div",{className:"story-text-wrapper"},m("h3",null,m("i",{style:{marginRight:"5px"},class:""+t.attributes.contentIcon})),m("p",null,t.attributes.title)),m("div",{className:"story-actions-btn"},m("button",{onclick:function(){return e().modal.show(N,{story:t})},className:"Button"},t.attributes.cta),p&&m("button",{onclick:function(){return e().modal.show(x,{story:t,user:l})},className:"Button"},m("i",{class:"fas fa-edit"})),u&&m("button",{onclick:function(){return i.deleteStory(t.id)},className:"Button Button--danger"},m("i",{class:"fas fa-trash-alt"}))))})))),this.userStories&&(null==(n=this.userStories)?void 0:n.data.length)>7&&m("div",{className:"user-story-pagination"},m("button",{disabled:this.userStories&&this.userStories.data.length<=8,class:"Button",onclick:function(){var t,o,r,e=null!=(t=null==(o=i.userStories)?void 0:o.links.prev)?t:null==(r=i.userStories)?void 0:r.links.first;i.getAllUserStory(e)}},e().translator.trans("justoverclock-profile-stories.forum.prevPage")),m("button",{disabled:this.userStories&&(null==(a=this.userStories)?void 0:a.data.length)<=8,class:"Button",onclick:function(){var t;return i.getAllUserStory(null==(t=i.userStories)?void 0:t.links.next)}},e().translator.trans("justoverclock-profile-stories.forum.nextPage"))))},o}(f()),C=function(t){function o(){for(var o,r=arguments.length,s=new Array(r),n=0;n<r;n++)s[n]=arguments[n];return(o=t.call.apply(t,[this].concat(s))||this).assetPath=e().forum.attribute("baseUrl")+"/assets/",o.fullPath=e().forum.attribute("baseUrl")+"/assets/"+e().forum.attribute("justoverclock-profile-stories.imagePreview"),o.fallback="https://placehold.co/1920x400",o.heroBg=e().forum.attribute("justoverclock-profile-stories.imagePreview")?o.fullPath:o.fallback,o}a(o,t);var r=o.prototype;return r.oninit=function(o){var r;t.prototype.oninit.call(this,o),this.loadUser(null!=(r=this.attrs.username)?r:null)},r.view=function(){return m("div",{className:"UserPage"},m("div",{className:"Hero UserHero stories-hero"},m("img",{className:"hero-bg",src:this.heroBg,alt:"user stories"}),m("h1",{className:"hero-title"},this.attrs.username,e().translator.trans("justoverclock-profile-stories.forum.heroTitle"))),this.user?m("div",{className:"container"},m("div",{className:"sideNavContainer"},m("nav",{className:"sideNav UserPage-nav"},m("ul",null,u()(this.sidebarItems().toArray()))),m("div",{className:"sideNavOffset UserPage-content"},m(w,{userId:this.user.id(),user:this.user})))):null)},o}(l());const I=flarum.core.compat["forum/components/UserCard"];var U=t.n(I);const P=flarum.core.compat["components/LinkButton"];var B=t.n(P);const F=flarum.core.compat["common/helpers/icon"];var T=t.n(F);const A=flarum.core.compat["forum/components/IndexPage"];var O=t.n(A),L=function(t){function o(){for(var o,r=arguments.length,e=new Array(r),s=0;s<r;s++)e[s]=arguments[s];return(o=t.call.apply(t,[this].concat(e))||this).loading=!1,o.globalStories=null,o}a(o,t);var r=o.prototype;return r.oninit=function(o){t.prototype.oninit.call(this,o),this.getStories()},r.getStories=function(t){var o=this;void 0===t&&(t=e().forum.attribute("apiUrl")+"/global-stories"),this.loading=!0,e().request({method:"GET",url:t}).then((function(t){o.globalStories=t,m.redraw()})).finally((function(){o.loading=!1,m.redraw()}))},r.view=function(t){var o,r,s=this;return m("div",{className:"IndexPage"},O().prototype.hero(),m("div",{className:"container"},m("div",{className:"sideNavContainer"},m("nav",{className:"IndexPage-nav sideNav"},m("ul",null,u()(O().prototype.sidebarItems().toArray()))),m("div",{className:"IndexPage-results sideNavOffset"},m("h1",{style:{margin:0},className:"glostitle"},e().translator.trans("justoverclock-profile-stories.forum.globalStoriesTitle")),this.loading&&m(j(),null),!this.loading&&this.globalStories&&this.globalStories.data.length<=0&&m("p",{className:"global-stories-description"},e().translator.trans("justoverclock-profile-stories.forum.globalStoriesEmpty")),!this.loading&&this.globalStories&&this.globalStories.data.length>0&&m("div",null,m("p",{className:"global-stories-description"},e().translator.trans("justoverclock-profile-stories.forum.globalStoriesDescription")),m("div",{className:"stories-all"},!this.loading&&this.globalStories&&this.globalStories.data.map((function(t){return m("div",{onclick:function(){return e().modal.show(N,{story:t})},className:"story-item",style:{backgroundImage:"url("+t.attributes.imgUrl+")",backgroundSize:"cover"}},m("div",{className:"story-text-wrapper-global"},m("h3",null,m("i",{style:{marginRight:"5px"},class:"fa-solid "+t.attributes.contentIcon}),t.attributes.title),m("p",null,m("i",{style:{marginRight:"5px"},class:"fas fa-user"}),t.attributes.username)))})))),!this.loading&&this.globalStories&&this.globalStories.data.length>15&&m("div",{className:"user-story-pagination"},m("button",{disabled:this.globalStories&&(null==(o=this.globalStories)?void 0:o.data.length)<=19,class:"Button",onclick:function(){var t;return s.getStories(null==(t=s.globalStories)?void 0:t.links.prev)}},e().translator.trans("justoverclock-profile-stories.forum.prevPage")),m("button",{disabled:this.globalStories&&(null==(r=this.globalStories)?void 0:r.data.length)<=19,class:"Button",onclick:function(){var t;return s.getStories(null==(t=s.globalStories)?void 0:t.links.next)}},e().translator.trans("justoverclock-profile-stories.forum.nextPage")))))))},o}(f());const E=flarum.core.compat["forum/components/Notification"];var D=function(t){function o(){return t.apply(this,arguments)||this}a(o,t);var r=o.prototype;return r.content=function(){},r.excerpt=function(){return e().translator.trans("justoverclock-profile-stories.forum.notifications.newStory")},r.href=function(){var t,o,r=null==(t=this.attrs.notification)||null==(t=t.data)||null==(t=t.attributes)||null==(t=t.content)||null==(t=t.user)?void 0:t.username;return console.log(null==(o=this.attrs.notification)||null==(o=o.data)||null==(o=o.attributes)||null==(o=o.content)?void 0:o.user),e().forum.attribute("baseUrl")+"/u/"+r+"/stories"},r.icon=function(){return"fas fa-book-open"},o}(t.n(E)());const M=flarum.core.compat["forum/components/NotificationGrid"];var q=t.n(M),H=[{name:"newStory",icon:"fas fa-book-open",label:"New Story"}];e().initializers.add("justoverclock/profile-stories",(function(){e().notificationComponents.newStory=D,e().routes["user.stories"]={path:"/u/:username/stories",component:C},e().routes.globalStories={path:"/all-users-stories",component:L},(0,s.extend)(q().prototype,"notificationTypes",(function(t){H.forEach((function(o){t.add(o.name,{name:o.name,icon:o.icon,label:o.label})}))})),(0,s.extend)(O().prototype,"navItems",(function(t){t.add("globalStories",m(B(),{href:e().route("globalStories"),icon:"fas fa-book-open"},e().translator.trans("justoverclock-profile-stories.forum.globalStories")))})),(0,s.extend)(U().prototype,"infoItems",(function(t){var o,r=this.attrs.user,s=null==(o=r.data)||null==(o=o.attributes)?void 0:o.storyCount;r&&e().session.user&&t.add("storiesCount",m("span",{className:"UserCard-storiesCount"},T()("fas fa-book-open"),e().translator.trans("justoverclock-profile-stories.forum.stories-count",{count:s})))})),(0,s.extend)(l().prototype,"navItems",(function(t){var o=this.user;o&&t.add("profilestories",m(B(),{href:e().route("user.stories",{username:null==o?void 0:o.slug()}),name:"stories",icon:"fas fa-book-open"},e().translator.trans("justoverclock-profile-stories.forum.stories")))}))}))})(),module.exports={}})();
//# sourceMappingURL=forum.js.map