(()=>{var t={n:o=>{var r=o&&o.__esModule?()=>o.default:()=>o;return t.d(r,{a:r}),r},d:(o,r)=>{for(var e in r)t.o(r,e)&&!t.o(o,e)&&Object.defineProperty(o,e,{enumerable:!0,get:r[e]})},o:(t,o)=>Object.prototype.hasOwnProperty.call(t,o)};(()=>{"use strict";const o=flarum.core.compat["common/app"];t.n(o)().initializers.add("justoverclock/profile-stories",(function(){console.log("[justoverclock/profile-stories] Hello, forum and admin!")}));const r=flarum.core.compat["forum/app"];var e=t.n(r);const s=flarum.core.compat["common/extend"];function n(t,o){return n=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,o){return t.__proto__=o,t},n(t,o)}function a(t,o){t.prototype=Object.create(o.prototype),t.prototype.constructor=t,n(t,o)}const i=flarum.core.compat["forum/components/UserPage"];var l=t.n(i);const c=flarum.core.compat["common/helpers/listItems"];var u=t.n(c);const p=flarum.core.compat["common/Component"];var f=t.n(p);const d=flarum.core.compat["common/components/Modal"];var h=t.n(d);const v=flarum.core.compat["common/utils/Stream"];var y=t.n(v),g=function(t){function o(){for(var o,r=arguments.length,e=new Array(r),s=0;s<r;s++)e[s]=arguments[s];return(o=t.call.apply(t,[this].concat(e))||this).step=0,o.story_title=y()(""),o.story_imgUrl=y()(""),o.story_cta=y()(""),o.story_icon=y()(""),o.story_text=y()(""),o.story_content_cta=y()(""),o.story_content_link=y()(""),o}a(o,t);var r=o.prototype;return r.className=function(){return"create-story-modal"},r.title=function(){return e().translator.trans("justoverclock-profile-stories.forum.createStory")},r.content=function(){var t=this;return console.log("aaaaaaa",this.attrs.username),m("div",{className:"new-story-container"},m("div",{className:"new-story-content"},0===this.step&&m("div",{className:"story-step-container"},m("input",{value:this.story_title(),oninput:function(o){return t.story_title(o.target.value)},placeholder:e().translator.trans("justoverclock-profile-stories.forum.storyTitle"),className:"FormControl",type:"text"}),m("input",{value:this.story_imgUrl(),oninput:function(o){return t.story_imgUrl(o.target.value)},placeholder:e().translator.trans("justoverclock-profile-stories.forum.storyImage"),className:"FormControl",type:"url"}),m("input",{value:this.story_cta(),oninput:function(o){return t.story_cta(o.target.value)},placeholder:e().translator.trans("justoverclock-profile-stories.forum.storyCta"),className:"FormControl",type:"text"})),1===this.step&&m("div",{className:"story-step-container"},m("input",{value:this.story_icon(),oninput:function(o){return t.story_icon(o.target.value)},placeholder:e().translator.trans("justoverclock-profile-stories.forum.storyIcon"),className:"FormControl",type:"text"}),m("input",{value:this.story_content_link(),oninput:function(o){return t.story_content_link(o.target.value)},placeholder:e().translator.trans("justoverclock-profile-stories.forum.storyContentLink"),className:"FormControl",type:"text"}),m("input",{value:this.story_content_cta(),oninput:function(o){return t.story_content_cta(o.target.value)},placeholder:e().translator.trans("justoverclock-profile-stories.forum.storyContentCta"),className:"FormControl",type:"text"}),m("textarea",{rows:6,value:this.story_text(),oninput:function(o){return t.story_text(o.target.value)},placeholder:e().translator.trans("justoverclock-profile-stories.forum.storyContentText"),className:"FormControl"}))),m("form",{className:"new-story-actions",onsubmit:function(t){return t.preventDefault()}},m("button",{disabled:this.step<1,className:"Button",onclick:this.stepDecrement.bind(this)},e().translator.trans("justoverclock-profile-stories.forum.previousStepBtn")),this.step<1&&m("button",{className:"Button",onclick:this.stepIncrement.bind(this)},e().translator.trans("justoverclock-profile-stories.forum.nextStepBtn")),1===this.step&&m("button",{onclick:this.complete.bind(this),className:"Button",type:"submit"},e().translator.trans("justoverclock-profile-stories.forum.saveBtn"))))},r.stepIncrement=function(){this.step<1&&(this.step++,m.redraw()),m.redraw()},r.stepDecrement=function(){this.step>0&&(this.step--,m.redraw()),m.redraw()},r.complete=function(){var t=this;e().request({method:"POST",url:e().forum.attribute("apiUrl")+"/create-story",body:{data:{attributes:{user_id:this.attrs.userId,title:this.story_title(),img_url:this.story_imgUrl(),cta:this.story_cta(),content_icon:this.story_icon(),content_text:this.story_text(),content_cta:this.story_content_cta(),content_link:this.story_content_link(),username:this.attrs.username}}}}).then((function(){t.hide(),t.attrs.refreshStories()}))},o}(h()),b=function(t){function o(){return t.apply(this,arguments)||this}a(o,t);var r=o.prototype;return r.oninit=function(o){t.prototype.oninit.call(this,o)},r.view=function(t){return m("div",{className:"permission-denied-container"},m("div",{className:"permission-denied-content"},e().translator.trans("justoverclock-profile-stories.forum.youDontHavePermission")))},o}(f());const N=flarum.core.compat["common/components/Link"];var k=t.n(N),S=function(t){function o(){return t.apply(this,arguments)||this}a(o,t);var r=o.prototype;return r.className=function(){return"complete-story-modal"},r.title=function(){var t;return this.attrs.story,(null==(t=e().session)||null==(t=t.user)?void 0:t.displayName())+" "+e().translator.trans("justoverclock-profile-stories.forum.StoryModalTitle")},r.content=function(){var t=this.attrs.story;return m("div",{className:"complete-story-container"},m("div",{className:"complete-story-content"},m("div",{className:"complete-story-title"},m("i",{class:"story-icon fa-solid "+t.attributes.contentIcon}),m("h3",null,t.attributes.title)),m("img",{className:"complete-story-img",src:t.attributes.imgUrl,alt:t.attributes.title}),m("p",null,m.trust(t.attributes.contentText)),m(k(),{href:t.attributes.contentLink},m("button",{className:"Button"},t.attributes.contentCta))))},o}(h());const _=flarum.core.compat["common/components/LoadingIndicator"];var j=t.n(_),x=function(t){function o(){for(var o,r=arguments.length,e=new Array(r),s=0;s<r;s++)e[s]=arguments[s];return(o=t.call.apply(t,[this].concat(e))||this).userStories=null,o.currentPage=1,o.totalPages=1,o.loading=!1,o}a(o,t);var r=o.prototype;return r.oninit=function(o){t.prototype.oninit.call(this,o),this.loading=!1,this.currentPage=1,this.totalPages=1,this.getAllUserStory()},r.showCreateStoryModal=function(){var t;e().modal.show(g,{refreshStories:this.getAllUserStory.bind(this),username:null==(t=this.attrs.user.data)||null==(t=t.attributes)?void 0:t.username,userId:this.attrs.user.id()})},r.getAllUserStory=function(t){var o=this;void 0===t&&(t=e().forum.attribute("apiUrl")+"/stories?userId="+this.attrs.userId),this.loading=!0,e().request({method:"GET",url:t}).then((function(t){o.userStories=t,m.redraw()})).finally((function(){o.loading=!1,m.redraw()}))},r.view=function(t){var o,r,s=this,n=this.attrs.user,a=(null==n||null==(o=n.data.attributes)?void 0:o.canCreateStory)||!1;return m("div",{className:"PostsUserPage"},this.loading&&m(j(),null),!this.loading&&m("div",{className:"stories-content"},!a&&m(b,null),a&&m("button",{onclick:this.showCreateStoryModal.bind(this),className:"Button Button--primary stories-btn"},e().translator.trans("justoverclock-profile-stories.forum.createStory")),m("div",{className:"stories-all"},this.userStories&&this.userStories.data.map((function(t){return m("div",{className:"story-item",style:{backgroundImage:"url("+t.attributes.imgUrl+")",backgroundSize:"cover"}},m("div",{className:"story-text-wrapper"},m("h3",null,m("i",{style:{marginRight:"5px"},class:""+t.attributes.contentIcon})),m("p",null,t.attributes.title)),m("button",{onclick:function(){return e().modal.show(S,{story:t})},className:"Button"},t.attributes.cta))})))),m("div",{className:"user-story-pagination"},m("button",{disabled:this.userStories&&this.userStories.data.length<=8,class:"Button",onclick:function(){var t,o,r,e=null!=(t=null==(o=s.userStories)?void 0:o.links.prev)?t:null==(r=s.userStories)?void 0:r.links.first;s.getAllUserStory(e)}},e().translator.trans("justoverclock-profile-stories.forum.prevPage")),m("button",{disabled:this.userStories&&(null==(r=this.userStories)?void 0:r.data.length)<=8,class:"Button",onclick:function(){var t;return s.getAllUserStory(null==(t=s.userStories)?void 0:t.links.next)}},e().translator.trans("justoverclock-profile-stories.forum.nextPage"))))},o}(f()),w=function(t){function o(){for(var o,r=arguments.length,s=new Array(r),n=0;n<r;n++)s[n]=arguments[n];return(o=t.call.apply(t,[this].concat(s))||this).heroBg=e().forum.attribute("baseUrl")+"/assets/extensions/justoverclock-profile-stories/stories-header.png",o}a(o,t);var r=o.prototype;return r.oninit=function(o){var r;t.prototype.oninit.call(this,o),this.loadUser(null!=(r=this.attrs.username)?r:null)},r.view=function(){return m("div",{className:"UserPage"},m("div",{className:"Hero UserHero stories-hero"},m("img",{className:"hero-bg",src:this.heroBg,alt:"user stories"}),m("h1",{className:"hero-title"},this.attrs.username,e().translator.trans("justoverclock-profile-stories.forum.heroTitle"))),this.user?m("div",{className:"container"},m("div",{className:"sideNavContainer"},m("nav",{className:"sideNav UserPage-nav"},m("ul",null,u()(this.sidebarItems().toArray()))),m("div",{className:"sideNavOffset UserPage-content"},m(x,{userId:this.user.id(),user:this.user})))):null)},o}(l());const U=flarum.core.compat["forum/components/UserCard"];var C=t.n(U);const I=flarum.core.compat["components/LinkButton"];var P=t.n(I);const B=flarum.core.compat["common/helpers/icon"];var A=t.n(B);const O=flarum.core.compat["forum/components/IndexPage"];var T=t.n(O),F=function(t){function o(){for(var o,r=arguments.length,e=new Array(r),s=0;s<r;s++)e[s]=arguments[s];return(o=t.call.apply(t,[this].concat(e))||this).loading=!1,o.globalStories=null,o}a(o,t);var r=o.prototype;return r.oninit=function(o){t.prototype.oninit.call(this,o),this.getStories()},r.getStories=function(t){var o=this;void 0===t&&(t=e().forum.attribute("apiUrl")+"/global-stories"),this.loading=!0,e().request({method:"GET",url:t}).then((function(t){o.globalStories=t,m.redraw()})).finally((function(){o.loading=!1,m.redraw()}))},r.view=function(t){var o,r,s=this;return m("div",{className:"IndexPage"},T().prototype.hero(),m("div",{className:"container"},m("div",{className:"sideNavContainer"},m("nav",{className:"IndexPage-nav sideNav"},m("ul",null,u()(T().prototype.sidebarItems().toArray()))),m("div",{className:"IndexPage-results sideNavOffset"},m("h1",{style:{margin:0},className:"glostitle"},e().translator.trans("justoverclock-profile-stories.forum.globalStoriesTitle")),this.globalStories&&this.globalStories.data.length<=0&&m("p",{className:"global-stories-description"},e().translator.trans("justoverclock-profile-stories.forum.globalStoriesEmpty")),this.globalStories&&this.globalStories.data.length>0&&m("div",null,m("p",{className:"global-stories-description"},e().translator.trans("justoverclock-profile-stories.forum.globalStoriesDescription")),m("div",{className:"stories-all"},this.globalStories&&this.globalStories.data.map((function(t){return m("a",{href:e().forum.attribute("baseUrl")+"/u/"+t.attributes.username+"/stories"},m("div",{className:"story-item",style:{backgroundImage:"url("+t.attributes.imgUrl+")",backgroundSize:"cover"}},m("div",{className:"story-text-wrapper-global"},m("h3",null,m("i",{style:{marginRight:"5px"},class:"fa-solid "+t.attributes.contentIcon}),t.attributes.title),m("p",null,m("i",{style:{marginRight:"5px"},class:"fas fa-user"}),t.attributes.username))))})))),this.globalStories&&this.globalStories.data.length>15&&m("div",{className:"user-story-pagination"},m("button",{disabled:this.globalStories&&(null==(o=this.globalStories)?void 0:o.data.length)<=19,class:"Button",onclick:function(){var t;return s.getStories(null==(t=s.globalStories)?void 0:t.links.prev)}},e().translator.trans("justoverclock-profile-stories.forum.prevPage")),m("button",{disabled:this.globalStories&&(null==(r=this.globalStories)?void 0:r.data.length)<=19,class:"Button",onclick:function(){var t;return s.getStories(null==(t=s.globalStories)?void 0:t.links.next)}},e().translator.trans("justoverclock-profile-stories.forum.nextPage")))))))},o}(f());const D=flarum.core.compat["forum/components/Notification"];var L=function(t){function o(){return t.apply(this,arguments)||this}a(o,t);var r=o.prototype;return r.content=function(){},r.excerpt=function(){return e().translator.trans("justoverclock-profile-stories.forum.notifications.newStory")},r.href=function(){var t,o,r=null==(t=this.attrs.notification)||null==(t=t.data)||null==(t=t.attributes)||null==(t=t.content)||null==(t=t.user)?void 0:t.username;return console.log(null==(o=this.attrs.notification)||null==(o=o.data)||null==(o=o.attributes)||null==(o=o.content)?void 0:o.user),e().forum.attribute("baseUrl")+"/u/"+r+"/stories"},r.icon=function(){return"fas fa-book-open"},o}(t.n(D)());const M=flarum.core.compat["forum/components/NotificationGrid"];var z=t.n(M),E=[{name:"newStory",icon:"fas fa-book-open",label:"New Story"}];e().initializers.add("justoverclock/profile-stories",(function(){e().notificationComponents.newStory=L,e().routes["user.stories"]={path:"/u/:username/stories",component:w},e().routes.globalStories={path:"/all-users-stories",component:F},(0,s.extend)(z().prototype,"notificationTypes",(function(t){E.forEach((function(o){t.add(o.name,{name:o.name,icon:o.icon,label:o.label})}))})),(0,s.extend)(T().prototype,"navItems",(function(t){t.add("globalStories",m(P(),{href:e().route("globalStories"),icon:"fas fa-book-open"},e().translator.trans("justoverclock-profile-stories.forum.globalStories")))})),(0,s.extend)(C().prototype,"infoItems",(function(t){var o,r=null==(o=this.attrs.user.data)||null==(o=o.attributes)?void 0:o.storyCount;t.add("storiesCount",m("span",{className:"UserCard-storiesCount"},A()("fas fa-book-open"),e().translator.trans("justoverclock-profile-stories.forum.stories-count",{count:r})))})),(0,s.extend)(l().prototype,"navItems",(function(t){var o=this.user;o&&t.add("profilestories",m(P(),{href:e().route("user.stories",{username:null==o?void 0:o.slug()}),name:"stories",icon:"fas fa-users"},e().translator.trans("justoverclock-profile-stories.forum.stories")))}))}))})(),module.exports={}})();
//# sourceMappingURL=forum.js.map